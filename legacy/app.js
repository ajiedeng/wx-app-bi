"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_wepy=require("./npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy);require("./npm/wepy-async-function/index.js");var _require=require("./utils/log.js"),printAndUpload=_require.printAndUpload,_require2=require("./utils/loginInfo.js"),getCookie=_require2.getCookie,getUserInfo=_require2.getUserInfo,_class=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.globalData={loginUrl:"https://acs-so.ibroadlink.com/",baseUrl:require("./utils/net.js").baseUrl,userInfo:{},isFirstTime:!0,version:"2.0.8",wxUserInfo:{},locationInfo:{},params:{},logInfo:!1,allUsers:[],allChargers:{},chargerArr:[],groupChargers:{},groupArr:[],ccInfo:[],issueInfo:{},tabsInfo:{},isLogin:!1,jobId:"",windowWH:{width:375,height:667},atIds:[],atIdLists:[],system:""},e.config={pages:["pages/index","pages/login","pages/user"],subPackages:[{root:"task",name:"task",independent:!1,pages:["pages/taskManage","pages/taskDetail","pages/taskAudit","pages/taskFlow","pages/taskCreate","pages/taskDraft","pages/taskCreateSearch","pages/taskCC","pages/taskCharger"]}],permission:{"scope.userLocation":{desc:"是否允许获取您的位置"}},window:{backgroundTextStyle:"light",navigationBarBackgroundColor:"#1C245F",navigationBarTitleText:"",navigationBarTextStyle:"white",navigationStyle:"custom"},tabBar:{selectedColor:"#324EBD",borderStyle:"black",backgroundColor:"#ffffff",list:[{pagePath:"pages/index",text:"首页",iconPath:"./assets/images/common/tab_1_unselected.png",selectedIconPath:"./assets/images/common/tab_1_selected.png"},{pagePath:"pages/user",text:"我的",iconPath:"./assets/images/common/tab_2_unselected.png",selectedIconPath:"./assets/images/common/tab_2_selected.png"}]},networkTimeout:{request:1e4,downloadFile:1e4},sitemapLocation:"sitemap.json"},e.use("requestfix"),e.use("promisify"),e.intercept("request",{config:function(e){this.getStorage(e);var t=e.url!==_wepy2.default.$instance.globalData.loginUrl+"cloud/office/cerberus/longin";return!e.header.userid&&t&&_wepy2.default.navigateTo({url:"/pages/login/login"}),e},success:function(e){return e},fail:function(e){return e},complete:function(e){return e}}),e.intercept("uploadFile",{config:function(e){return this.getStorage(e),e.header["Content-Type"]="multipart/form-data",e},success:function(e){return e.data},fail:function(e){return e},complete:function(e){return e}}),e}return _inherits(t,e),_createClass(t,[{key:"onLaunch",value:function(){console.log("onLaunch"),_wepy2.default.$instance.globalData=_wepy2.default.$instance.globalData||{},this.autoUpdate();try{var e=require("./utils/loginInfo.js"),t=e.getCookie,n=e.getUserInfo;t()&&(console.log("getCookie"),_wepy2.default.$instance.globalData.isLogin=!0,_wepy2.default.$instance.globalData.userInfo=n())}catch(e){_wepy2.default.showToast({title:"数据转换失败："+e})}}},{key:"onLoad",value:function(){}},{key:"onShow",value:function(){_wepy2.default.$instance.globalData.isFirstTime&&(_wepy2.default.$instance.globalData.isFirstTime=!1)}},{key:"onHide",value:function(e){_wepy2.default.$instance.globalData.isFirstTime=!1}},{key:"onError",value:function(e){printAndUpload.error("wx.onError",e),_wepy2.default.showToast({title:"onError:"+JSON.stringify(e),icon:"none",duration:5e3})}},{key:"onPageNotFound",value:function(e){printAndUpload.warn("onPageNotFound = "+JSON.stringify(e)),_wepy2.default.redirectTo({url:"/pages/index/index"})}},{key:"userInfoReadyCallback",value:function(e){e&&e.userInfo&&(_wepy2.default.$instance.globalData.wxUserInfo=e.userInfo||{})}},{key:"getStorage",value:function(e){var t=getUserInfo(!0);_wepy2.default.$instance.globalData.userInfo=t,e.header.Cookie=getCookie(),e.header.companyid=t.companyid,e.header.userid=t.userid}},{key:"autoUpdate",value:function(){var e=this;if(wx.canIUse("getUpdateManager")){var t=wx.getUpdateManager();t.onCheckForUpdate(function(n){n.hasUpdate&&wx.showModal({title:"更新提示",content:"检测到新版本，是否下载新版本并重启小程序？",success:function(n){n.confirm?e.downLoadAndUpdate(t):n.cancel&&wx.showModal({title:"温馨提示~",content:"本次版本更新涉及到新的功能添加，旧版本无法正常访问的哦~",showCancel:!1,confirmText:"确定更新",success:function(n){n.confirm&&e.downLoadAndUpdate(t)}})}})})}else wx.showModal({title:"提示",content:"当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。"})}},{key:"downLoadAndUpdate",value:function(e){wx.showLoading(),e.onUpdateReady(function(){wx.hideLoading(),e.applyUpdate()}),e.onUpdateFailed(function(){wx.showModal({title:"已经有新版本了哟",content:"新版本已经上线啦,请您删除当前小程序,重新搜索打开",success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}})})}}]),t}(_wepy2.default.app);App(require("./npm/wepy/lib/wepy.js").default.$createApp(_class,{noPromiseAPI:["createSelectorQuery"]}));