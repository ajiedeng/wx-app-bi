"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_utils=require("./../utils/utils.js"),_utils2=_interopRequireDefault(_utils),commonApi=function(e){function r(){var e,t,n,i;_classCallCheck(this,r);for(var a=arguments.length,s=Array(a),u=0;u<a;u++)s[u]=arguments[u];return t=n=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(s))),n.data={OPList:[],PMList:[]},n.methods={},i=t,_possibleConstructorReturn(n,i)}return _inherits(r,e),_createClass(r,[{key:"handleRepeat",value:function(e,r){if(Array.isArray(e)&&e.length<2)return e;for(var t=0,n=e.length;t<n;t++)for(var i=t+1;i<n;i++){if(!e[t]){e.splice(t,1),n--,t--;break}if(!e[i]){e.splice(i,1),t--,i--,n--;break}e[i][r]!==e[t][r]||(e.splice(i,1),i--,n--)}return e}},{key:"removeStorage",value:function(){this.$parent.globalData.ccInfo=[],this.$parent.globalData.issueInfo={},this.$parent.globalData.tabsInfo={}}},{key:"dealWithUsers",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e.filter(function(e){return!(e[r.name].indexOf(e[r.id])>-1||e[r.name].indexOf("找不到")>-1||""===e[r.name])});var t={user:[{A:[],B:[],C:[],D:[],E:[],F:[],G:[],H:[],I:[],J:[],K:[],L:[],M:[],N:[],O:[],P:[],Q:[],R:[],S:[],T:[],U:[],V:[],W:[],X:[],Y:[],Z:[],UN:[]}]};e.forEach(function(e){e.checked||(e.checked=!1);var n=_utils2.default.pinyin.getFullChars(e[r.name])[0];n&&(n=n.toUpperCase(),e.key=n,e.name=e[r.name],e.pinyin=_utils2.default.pinyin.getFullChars(e[r.name])),t.user[0][n]?t.user[0][n].push(e):t.user[0].UN.push(e)});var n=t.user[0];for(var i in n)0===n[i].length&&delete n[i];var a=[];for(var s in n)n[s].sort(_utils2.default.sortFun("pinyin","desc")),a.push(s);return{chargerChild:n,chargerArr:a}}},{key:"checkHasTag",value:function(e){return!!e&&(e.indexOf("#")>-1&&e.indexOf("#CREAT")<0||e.indexOf("@")>-1||e.indexOf("$")>-1)}},{key:"splitTag",value:function(e,r){var t=null,n="",i="",a="";return this.checkHasTag(e)?(e.indexOf("#")>-1?(a=r,n=e.split("#")[1],t={tag:n,group:i,user_id:a}):e.indexOf("$")>-1&&e.indexOf("@")<0?(n=e.split("$")[1],t={tag:n,group:i,user_id:a}):e.indexOf("$")<0&&e.indexOf("@")>-1?(i=e.split("@")[1],t={tag:n,group:i,user_id:a}):(n=e.split("$")[1].split("@")[0],i=e.split("$")[1].split("@")[1],t={tag:n,group:i,user_id:a}),t):e.indexOf("#CREAT")>-1?"#CREAT":(a=e,t={tag:n,group:i,user_id:a})}},{key:"handleDefault",value:function(e,r){var t=e.deuserid,n=this.splitTag(t,this.userInfo.userid);"#CREAT"===n?(this.isCreater(e),n=null,r&&r(n)):r&&r(n)}},{key:"handleCondidate",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=this,n=arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.condidate_user,s=[];if(Array.isArray(a))return a.forEach(function(a,u){var o=null,l=t.$parent.globalData.userInfo,c=l.userid,h=l.nickname,f=l.phone,p=l.email,d=a.user_id;if("#CREAT"===(o=t.splitTag(d,t.userInfo.userid)))i||(i=!0,e.chargerList.push({userid:c,nickname:h,phone:f,email:p}));else if(r){var g=t.checkObjEqual(n,o);g||s.push(o)}else s.push(o)}),s}},{key:"handleBoth",value:function(e,r){var t=e.deuserid,n=this.splitTag(t,this.userInfo.userid);if("#CREAT"===n){this.isCreater(e),n=null;var i=this.handleCondidate(e,!1,!1,!0);r&&r(i)}else r&&r(n)}},{key:"checkObjEqual",value:function(e,r){var t=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(r);if(t.length!==n.length)return!1;for(var i=0;i<t.length;i++){var a=t[i],s=e[a],u=r[a];if("object"===(void 0===s?"undefined":_typeof(s)))return!!this.checkObjEqual(s,u);if(s!==u)return!1}return!0}},{key:"isCreater",value:function(e){var r=this.$parent.globalData.userInfo,t=r.userid,n=r.nickname,i=r.phone,a=r.email;e.chargerList.push({userid:t,nickname:n,phone:i,email:a}),e.charger=this.userInfo.userid,e.chargerName=this.userInfo.nickname,this.handleCharger(e)}},{key:"handleCharger",value:function(e,r,t){var n=this.dealWithUsers(e.chargerList,{name:"nickname",id:"userid"});e.chargerArr=n.chargerArr,e.chargerChild=n.chargerChild,e.chargerlib=n.chargerChild,r&&(t&&t(e),this.chargers=n.chargerChild,this.chargerArr=n.chargerArr,this.chargerChild=n.chargerChild,this.chargerlib=n.chargerChild),this.$apply()}}]),r}(_wepy2.default.mixin);exports.default=commonApi;