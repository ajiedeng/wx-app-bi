"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(e,t){function a(i,r){try{var n=s[i](r),u=n.value}catch(e){return void t(e)}if(!n.done)return Promise.resolve(u).then(function(e){a("next",e)},function(e){a("throw",e)});e(u)}return a("next")})}}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,s){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!s||"object"!=typeof s&&"function"!=typeof s?e:s}function _inherits(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function, not "+typeof s);e.prototype=Object.create(s&&s.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,s){for(var t=0;t<s.length;t++){var a=s[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(s,t,a){return t&&e(s.prototype,t),a&&e(s,a),s}}(),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_topBar=require("./../../components/topBar.js"),_topBar2=_interopRequireDefault(_topBar),_moduleInfo=require("./../../components/moduleInfo.js"),_moduleInfo2=_interopRequireDefault(_moduleInfo),_toast=require("./../../mixins/toast.js"),_toast2=_interopRequireDefault(_toast),_utils=require("./../../utils/utils.js"),_utils2=_interopRequireDefault(_utils),_http=require("./../../utils/http.js"),_commonApi=require("./../../mixins/commonApi.js"),_commonApi2=_interopRequireDefault(_commonApi),_loginInfo=require("./../../utils/loginInfo.js"),wxApis=require("./../../utils/wxApi.js"),fileFlag,year,month,day,taskCreate=function(e){function s(){var e,t,a,i;_classCallCheck(this,s);for(var r=arguments.length,n=Array(r),u=0;u<r;u++)n[u]=arguments[u];return t=a=_possibleConstructorReturn(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(n))),a.data={height:0,width:0,issueClass:"",issueSubClass:"",issueClassName:"",issueSubClassName:"",isShow:!1,isTx:null,index8:0,i:0,issueName:"",taskNumb:"",focus:!1,isBackShow:!0,index:0,txValue:"",ccArray:[],isToCC:!1,isToCharger:!1,issueSubClassSeleted:!1,issueModelInfo:{},ccList:[],jobModule:[],issueGraphList:[],issueClassList:[],issueSubClassList:[],issueClassIndex:0,issueSubClassIndex:0,timeoutIndex:0,issueClassParams:{pagesize:9999,pageid:0,user_bit:1},issueSubClassParams:{pagesize:9999,pageid:0,user_bit:1,show_flag:1},timeout:[24,48],timeoutValue:"",issueInfo:{},userInfo:{}},a.$repeat={},a.$props={topTaskCreate:{"xmlns:v-bind":"","v-bind:isBackShow.sync":"isBackShow","xmlns:v-on":"",bindparentBackFn:"parentBackFn"},moduleInfo:{"v-bind:jobModule.sync":"jobModule","v-bind:isShow.sync":"isShow","v-bind:isBackShow.sync":"isBackShow","v-bind:txValue.sync":"txValue"}},a.$events={topTaskCreate:{"v-on:topNavFn":"getScrollHeight"},moduleInfo:{"v-on:emitJsNode":"emitJsNode"}},a.components={topTaskCreate:_topBar2.default,moduleInfo:_moduleInfo2.default},a.events={parentBackFn:function(){_wepy2.default.navigateBack()}},a.mixins=[_commonApi2.default,_toast2.default],a.methods={getScrollHeight:function(e,s){var t=this,a=this.$parent.globalData.windowWH||{},i=a.width,r=a.height;r=r||667,t.width=i;var n=wx.createSelectorQuery();n.select("#topSearch").boundingClientRect(),n.exec(function(s){s[0]&&null!==s[0]&&s[0].height&&(t.height=i<768?r-s[0].height-e-54-12:r-s[0].height-e-184-12,t.$apply())})},issueClassChange:function(e){this.issueClassIndex=e.detail.value,this.issueClass=this.issueClassList[this.issueClassIndex].issue_class,this.issueClassName=this.issueClassList[this.issueClassIndex].issue_class_name,this.issueSubClass="",this.timeoutValue="",this.issueSubClassName="",this.issueSubClassList=[],this.issueModelInfo={},this.getIssueSubClassList(this.issueClass)},issueSubClassChange:function(e){this.issueSubClassIndex=e.detail.value,this.issueSubClass=this.issueSubClassList[this.issueSubClassIndex].issue_sub_class,this.issueSubClassName=this.issueSubClassList[this.issueSubClassIndex].issue_sub_class_name,this.getIssueSubClassInfo(this.issueSubClass)},taskNameChange:function(e){if(_utils2.default.emojiReg(e.detail.value))return this.taskCreatTip("文本不能包含表情符号");this.issueName=e.detail.value.trim()},timeoutChange:function(e){this.timeoutValue=e.detail.value,this.timeoutIndex=e.detail.value,this.issueModelInfo.time_out=this.timeout[e.detail.value]},textareaBlur:function(e){if(_utils2.default.emojiReg(e.detail.value))return this.taskCreatTip("文本不能包含表情符号");this.$broadcast("textareaBlur",e.detail.value)},textareaChange:function(e){this.$broadcast("textareaChange",e.detail.value)},saveTx:function(){this.isBackShow=!0,this.isShow=!1},deleteCC:function(e){this.ccList.splice(e,1),this.$parent.globalData.ccInfo=this.ccList},searchFocus:function(){this.isToCC=!1,this.isToCharger=!1,this.setIssueStorage(),_wepy2.default.navigateTo({url:"./taskCreateSearch"})},taskCreateDrafted:function(){var e=this.$parent.globalData.tabsInfo||{};e.tabs&&(e.tabs.activeIndex=4,e.tabs.status=["N"],e.tabs.currentTabUrl="list",this.$parent.globalData.tabsInfo=e),this.skip("N")},taskCreateConfirm:function(){this.tabsInfo=this.$parent.globalData.tabsInfo||{};var e=this.tabsInfo;e.tabs&&(e.tabs.activeIndex=1,e.tabs.status=[],e.tabs.currentTabUrl="list",this.$parent.globalData.tabsInfo=e),this.skip("N_JOB")},ccAdd:function(){this.isToCC=!0,this.isToCharger=!1,this.setIssueStorage(),_wepy2.default.navigateTo({url:"./taskCC"})},selectCharger:function(e,s){if(s.isEdit=!(s.chargerList.length<=1&&2===s.all_user&&s.charger),s.isEdit){this.isToCC=!1,this.isToCharger=!0,this.setIssueStorage();var t=1===s.all_user||2===s.all_user&&!s.deuserid&&s.condidate_user.length<=0,a={index:e,itemCharger:s,isAllUser:t};a=JSON.stringify(a),this.$preload("creatCharger",a),_wepy2.default.navigateTo({url:"./taskCharger"})}},emitJsNode:function(){function e(){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(){var s,t,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={job_info:{job_name:this.issueName,creat_user_name:this.userInfo.nickname,issue_class:this.issueClass,issue_class_name:this.issueClassName,issue_sub_class:this.issueSubClass,issue_sub_class_name:this.issueSubClassName,task_info:"",desc_info:this.jobModule||{},dead_line:"",status:"N",class:5,time_out:this.timeout[this.timeoutValue],multi_attach_buff:[],task_numb:this.taskNumb}},s.job_info.desc_info=JSON.stringify(s.job_info.desc_info),e.prev=2,e.next=5,(0,_http.changeNodeFromJS)(s);case 5:if(t=e.sent,t.node_owners){e.next=8;break}return e.abrupt("return");case 8:t.node_owners.forEach(function(e){var s=e.owner;a.issueGraphList.forEach(function(t){e.node_name===t.node_name&&(t.user_id=s.userid,t.chargerName=s.nickname,t.charger=s.userid)})}),this.$apply(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),wxApis.logMethod("log","changeNodeFromJS = "+JSON.stringify(e.t0),_wepy2.default.$instance.globalData.logInfo);case 15:case"end":return e.stop()}},e,this,[[2,12]])}));return e}()},i=t,_possibleConstructorReturn(a,i)}return _inherits(s,e),_createClass(s,[{key:"getIssueClassList",value:function(){function e(){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(){var s,t,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={issue_class_name:this.issueClassName,user_bit:this.issueClassParams.user_bit,pagesize:this.issueClassParams.pagesize,pageid:this.issueClassParams.pageid},e.prev=1,e.next=4,(0,_http.queryIssueClassList)(s);case 4:t=e.sent,t.list&&t.list.length>0?(this.issueClassList=t.list,this.issueClassList=this.issueClassList.filter(function(e){return 2!==e.show_flag}),this.issueClassIndex=this.issueClassList.findIndex(function(e){return e.issue_class===a.issueClass}),this.$apply()):wxApis.logMethod("log","queryIssueClassList = "+JSON.stringify(t),_wepy2.default.$instance.globalData.logInfo),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),wxApis.logMethod("log","queryIssueClassList = "+JSON.stringify(e.t0),_wepy2.default.$instance.globalData.logInfo);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return e}()},{key:"getIssueSubClassList",value:function(){function e(e){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(s){var t,a,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={user_bit:1,show_flag:1,issue_class:s,issue_class_name:this.issueClassName,issue_sub_class_name:this.issueSubClassName,pagesize:this.issueSubClassParams.pagesize,pageid:this.issueSubClassParams.pageid},e.prev=1,e.next=4,(0,_http.queryIssueSubClassList)(t);case 4:a=e.sent,a&&0===a.status?a.list&&a.list.length>0&&(this.issueSubClassList=a.list,this.issueSubClassIndex=this.issueSubClassList.findIndex(function(e){return e.issue_sub_class===i.issueSubClass}),this.$apply()):wxApis.logMethod("log","queryIssueSubClassList = "+JSON.stringify(a),_wepy2.default.$instance.globalData.logInfo),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),wxApis.logMethod("log","queryIssueSubClassList = "+JSON.stringify(e.t0),_wepy2.default.$instance.globalData.logInfo);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return e}()},{key:"getIssueSubClassInfo",value:function(){function e(e){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(s){var t,a,i,r,n,u,l,o,c,h=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={issue_sub_class:s},e.next=3,(0,_http.queryIssueSubClassInfo)(t);case 3:if(!(a=e.sent)||0!==a.status){e.next=35;break}if(!a.info){e.next=33;break}this.issueModelInfo=a.info,i=JSON.parse(a.info.default_cc||"[]"),r=[],n=[],r=i.filter(function(e){return e.user_id}),n=i.filter(function(e){return e.group_id}),u=this.$parent.globalData.allUsers,l=[],o=0;case 15:if(!(o<r.length)){e.next=27;break}c=0;case 17:if(!(c<u.length)){e.next=24;break}if(r[o].user_id!==u[c].userid){e.next=21;break}return l.push(r[o]),e.abrupt("break",24);case 21:c++,e.next=17;break;case 24:o++,e.next=15;break;case 27:this.ccList=l.concat(n),this.jobModule=a.info.info?JSON.parse(a.info.info):[],this.issueGraphList=a.graph_info?a.graph_info:[],this.issueGraphList.length>0&&this.issueGraphList.forEach(function(e,s){if(e.chargerArr=[],e.chargerList=[],e.chargerlib={},e.chargerChild={},e.deuserid&&e.condidate_user.length<=0)e.isDefault=!0,h.handleDefault(e,function(s){s&&h.getUserByTag(e,s)});else if(!e.deuserid&&e.condidate_user.length>0){e.isDefault=!1;var t=h.handleCondidate(e);t.length>0&&t.forEach(function(s){h.getUserByTag(e,s)})}else e.deuserid&&e.condidate_user.length>0&&h.handleBoth(e,function(s){Array.isArray(s)?s.length>0&&s.forEach(function(s){h.getUserByTag(e,s)}):h.getUserByTag(e,s,function(e,t){var a=e.chargerList;a.length>0&&(e.charger=a[0].userid,e.chargerName=a[0].nickname,e.nickname=a[0].nickname);var i=h.handleCondidate(e,!0,s);i.length>0&&i.forEach(function(s){h.getUserByTag(e,s)})})})}),this.jobModule.length>0&&this.jobModule.forEach(function(e,s){if(e.value="","5"===e.modeltype&&(e.selectedIndex=0),"4"===e.modeltype&&(e.value="[]",e.fileNameArr=[],e.attachfileArr=[],e.multi_attach_buff=[],e.imgUrlArr=[]),"6"===e.modeltype&&(e.value={},e.valueList=[]),"8"===e.modeltype){var t=e.tableObj.columns.length;if(e.tbodyArray=[],e.tableTotalArr=new Array(t).fill(""),e.tableObj.rows.length>0)e.tableObj.rows.forEach(function(s){var t=[];e.tableObj.columns.forEach(function(e){var a={columnsName:e.columnsName,rowsName:s,columnsType:e.columnsType,content:"",value:"",columnsRequired:e.columnsRequired||""};"date"===a.columnsType&&(a.startDate="1971-01-01",a.endDate="2100-12-31"),"datetime"===a.columnsType&&(a.multiIndex=_utils2.default.handleTimePicker().multiIndex.slice(0,5),a.multiArray=_utils2.default.handleTimePicker().multiArray.slice(0,5)),"select"===a.columnsType&&e.selectList.length>0&&(a.selectedIndex=0,a.selectedOption="",a.selectList=e.selectList),"file"===a.columnsType&&(a.value="[]",a.fileInfo="",a.fileNameArr=[],a.attachfileArr=[],a.multi_attach_buff=[],a.imgUrlArr=[]),t.push(a)}),e.tbodyArray.push(t)});else{var a=[];e.tableObj.columns.forEach(function(e){var s={columnsName:e.columnsName,rowsName:"",columnsType:e.columnsType,content:"",value:"",columnsRequired:e.columnsRequired||""};"date"===s.columnsType&&(s.startDate="1971-01-01",s.endDate="2100-12-31"),"datetime"===s.columnsType&&(s.multiIndex=_utils2.default.handleTimePicker().multiIndex.slice(0,5),s.multiArray=_utils2.default.handleTimePicker().multiArray.slice(0,5)),"select"===s.columnsType&&e.selectList.length>0&&(s.selectedIndex=0,s.selectedOption="",s.selectList=e.selectList),"file"===s.columnsType&&(s.value="[]",s.fileInfo="",s.fileNameArr=[],s.attachfileArr=[],s.multi_attach_buff=[],s.imgUrlArr=[]),a.push(s)}),e.tbodyArray.push(a)}}"9"===e.modeltype&&"1"===e.dateForm&&(e.startDate="1971-01-01",e.endDate="2100-12-31"),"9"===e.modeltype&&"2"===e.dateForm&&(e.multiIndex=_utils2.default.handleTimePicker().multiIndex.slice(0,5),e.multiArray=_utils2.default.handleTimePicker().multiArray.slice(0,5))}),this.$apply();case 33:e.next=36;break;case 35:wxApis.logMethod("log","queryIssueSubClassInfo = "+JSON.stringify(a),_wepy2.default.$instance.globalData.logInfo);case 36:case"end":return e.stop()}},e,this)}));return e}()},{key:"getUserByTag",value:function(){function e(e,t,a){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(s,t,a){var i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_http.queryUserByTag)(t);case 2:i=e.sent,i&&0===i.status?(r=i.list,Array.isArray(r)&&r.length>0?(r=r.filter(function(e){return e.nickname.indexOf("找不到")<0}),s.chargerList||(s.chargerList=[]),s.chargerList=s.chargerList.concat(r),this.handleRepeat(s.chargerList,"userid"),s.chargerList.length>0&&s.isDefault&&(s.charger=s.chargerList[0].userid,s.chargerName=s.chargerList[0].nickname,s.nickname=s.chargerList[0].nickname),a&&a(s,i),this.handleCharger(s)):(a&&a(s,i),this.handleCharger(s))):i&&0!==i.status?(s.chargerList=s.chargerList.concat([]),a&&a(s,i),this.handleCharger(s)):wxApis.logMethod("log","queryUserByTag = "+JSON.stringify(i),_wepy2.default.$instance.globalData.logInfo),this.$apply();case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"getByUserId",value:function(){function e(e,t){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(s,t){var a,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=[],e.prev=1,i=0;case 3:if(!(i<s.length)){e.next=11;break}return e.next=6,(0,_http.queryByUserId)({userid:s[i].user_id});case 6:r=e.sent,r&&0===r.status?a.push(r.userinfo.accountinfo):wxApis.logMethod("log","queryByUserId = "+JSON.stringify(r),_wepy2.default.$instance.globalData.logInfo);case 8:i++,e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),wxApis.logMethod("log","queryByUserId = "+JSON.stringify(e.t0),_wepy2.default.$instance.globalData.logInfo);case 16:t&&t(a);case 17:case"end":return e.stop()}},e,this,[[1,13]])}));return e}()},{key:"skip",value:function(){function e(e,t){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(s,t){var a,i,r,n,u,l,o,c,h,f,d,p,m,g,b,_,y,C=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.issueClass){e.next=2;break}return e.abrupt("return",this.taskCreatTip("请选择任务分类"));case 2:if(this.issueSubClass){e.next=4;break}return e.abrupt("return",this.taskCreatTip("请选择任务"));case 4:if(this.issueName){e.next=6;break}return e.abrupt("return",this.taskCreatTip("请输入任务名称"));case 6:if(!_utils2.default.regCheck(this.issueName)){e.next=8;break}return e.abrupt("return",this.taskCreatTip("任务名称需包含字母或汉字"));case 8:if(!_utils2.default.emojiReg(this.issueName)){e.next=10;break}return e.abrupt("return",this.taskCreatTip("任务名称不能包含表情符号"));case 10:if(""!==this.timeoutValue){e.next=12;break}return e.abrupt("return",this.taskCreatTip("请选择超时时间"));case 12:if("N"!==s){e.next=17;break}for(a=0;a<this.issueGraphList.length;a++)i=this.issueGraphList[a],i.chargerName?this.issueGraphList[a].user_id=i.charger:this.issueGraphList[a].user_id="";this.jobModule.length>0&&this.jobModule.forEach(function(e){if("1"===e.isShow){if(("2"===e.modeltype||"1"===e.modeltype||"10"===e.modeltype)&&e.value&&_utils2.default.emojiReg(e.value))return C.taskCreatTip(e.modelname+"不能包含表情符号");"3"!==e.modeltype&&"4"!==e.modeltype||(0===e.attachfileArr.length&&(e.attachfileArr=[]),e.value=JSON.stringify(e.attachfileArr))}}),e.next=83;break;case 17:r=0;case 18:if(!(r<this.issueGraphList.length)){e.next=28;break}if(n=this.issueGraphList[r],n.chargerName){e.next=24;break}return e.abrupt("return",this.taskCreatTip("请补全负责人"));case 24:this.issueGraphList[r].user_id=n.charger;case 25:r++,e.next=18;break;case 28:u=0;case 29:if(!(u<this.jobModule.length)){e.next=83;break}if(l=this.jobModule[u],"1"!==l.isShow){e.next=80;break}if("1"!==l.modeltype&&"2"!==l.modeltype&&"5"!==l.modeltype){e.next=44;break}if("1"!==l.isRequired){e.next=43;break}if(l.value&&"请选择"!==l.value&&"请输入"!==l.value){e.next=39;break}return o="5"===l.modeltype?"请选择":"请输入",e.abrupt("return",this.taskCreatTip(o+l.modelname));case 39:if(!l.value||!_utils2.default.emojiReg(l.value)){e.next=41;break}return e.abrupt("return",this.taskCreatTip(l.modelname+"不能包含表情符号"));case 41:e.next=44;break;case 43:"0"===l.isRequired&&(l.value&&"请选择"!==l.value&&"请输入"!==l.value||(l.value=""));case 44:if("3"!==l.modeltype&&"4"!==l.modeltype){e.next=49;break}if("1"!==l.isRequired){e.next=48;break}if(0!==l.attachfileArr.length){e.next=48;break}return e.abrupt("return",this.taskCreatTip("请上传"+l.modelname));case 48:l.value=JSON.stringify(l.attachfileArr);case 49:if("6"!==l.modeltype){e.next=52;break}if("1"!==l.isRequired||0!==l.valueList.length){e.next=52;break}return e.abrupt("return",this.taskCreatTip("请选择"+l.modelname));case 52:if("9"!==l.modeltype){e.next=55;break}if("1"!==l.isRequired||l.value&&"请选择"!==l.value&&"请输入"!==l.value){e.next=55;break}return e.abrupt("return",this.taskCreatTip("请选择"+l.modelname));case 55:if("10"!==l.modeltype){e.next=58;break}if("1"!==l.isRequired||l.value&&"请选择"!==l.value&&"请输入"!==l.value){e.next=58;break}return e.abrupt("return",this.taskCreatTip("请输入"+l.modelname));case 58:if("8"!==l.modeltype){e.next=80;break}if(c=l.tbodyArray,h=!1,!(c&&c.length>0)){e.next=80;break}f=0;case 63:if(!(f<c.length)){e.next=78;break}d=c[f],p=0;case 66:if(!(p<d.length)){e.next=75;break}if(m=d[p],h||(h=m.content&&"请选择"!==m.content||m.selectedOption||0===m.selectedOption),!(g="1"===m.columnsRequired&&((!m.content||"请选择"===m.content)&&"select"!==m.columnsType||"select"===m.columnsType&&!m.selectedOption))){e.next=72;break}return e.abrupt("return",this.taskCreatTip(l.modelname+"：表格里有必填项未填，请检查"));case 72:p++,e.next=66;break;case 75:f++,e.next=63;break;case 78:if("1"!==l.isRequired||h){e.next=80;break}return e.abrupt("return",this.taskCreatTip(l.modelname+"：表格里有必填项未填，请检查"));case 80:u++,e.next=29;break;case 83:return b=[],this.ccList.forEach(function(e){e.user_id?b.push({role_name:"CC",user_id:e.user_id}):e.group_id&&b.push({role_name:"CCG",group_id:e.group_id})}),_={jobinfo:{job_name:this.issueName,creat_user_name:this.userInfo.nickname,issue_class:this.issueClass,issue_class_name:this.issueClassName,issue_sub_class:this.issueSubClass,issue_sub_class_name:this.issueSubClassName,task_info:"",desc_info:this.jobModule||{},dead_line:"",status:s,class:5,time_out:this.timeout[this.timeoutValue],multi_attach_buff:[],task_numb:this.taskNumb},rolelist:b,jobnode:this.issueGraphList},_.jobinfo.desc_info.forEach(function(e){if("9"===e.modeltype&&("请选择"===e.value&&(e.value=""),"2"===e.dateForm&&(e.multiIndex=[],e.multiArray=[])),"8"===e.modeltype)for(var s=0;s<e.tbodyArray.length;s++)for(var t=e.tbodyArray[s],a=0;a<t.length;a++){var i=t[a];if("请选择"===i.content&&(i.content=""),("text"===i.columnsType||"urllink"===i.columnsType||"textarea"===i.columnsType)&&i.content&&_utils2.default.emojiReg(i.content))return C.taskCreatTip(i.columnsName+"不能包含表情符号");"datetime"===i.columnsType&&(i.multiTableIndex=[],i.multiTableArray=[]),"file"===i.columnsType&&(i.fileInfo&&i.fileInfo.source_id?i.value=JSON.stringify([i.fileInfo]):i.value="")}}),_.jobinfo.desc_info=JSON.stringify(_.jobinfo.desc_info),e.prev=88,e.next=91,(0,_http.createJob)(_);case 91:y=e.sent,y&&0===y.status?"N"===s?(this.$preload("jobId",y.jobid),_wepy2.default.redirectTo({url:"./taskDraft"})):_wepy2.default.navigateBack():wxApis.logMethod("log","createJob = "+JSON.stringify(y),!1),e.next=98;break;case 95:e.prev=95,e.t0=e.catch(88),wxApis.logMethod("log","createJob = "+JSON.stringify(e.t0),_wepy2.default.$instance.globalData.logInfo);case 98:case"end":return e.stop()}},e,this,[[88,95]])}));return e}()},{key:"addImages",value:function(){function e(e,t,a){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(s,t,a){var i,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=[],e.prev=1,r=0;case 3:if(!(r<s.length)){e.next=12;break}return e.next=6,(0,_http.uploadFile)({filePath:s[r],formData:{file:t}});case 6:n=e.sent,n=JSON.parse(n),n.sourceid&&i.push({file_name:s[r],source_id:n.sourceid});case 9:r++,e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),wxApis.logMethod("log","uploadFile = "+JSON.stringify(e.t0),_wepy2.default.$instance.globalData.logInfo);case 17:a&&a(i);case 18:case"end":return e.stop()}},e,this,[[1,14]])}));return e}()},{key:"setIssueStorage",value:function(){function e(){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s={issueClass:this.issueClass,issueSubClass:this.issueSubClass,issueClassName:this.issueClassName,issueSubClassName:this.issueSubClassName},this.$parent.globalData.issueInfo=s;case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"getAllUser",value:function(){function e(){return s.apply(this,arguments)}var s=_asyncToGenerator(regeneratorRuntime.mark(function e(){var s,t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_http.queryUserByrole)();case 2:s=e.sent,s&&0===s.status&&function(){var e=[],a=s.userlist;for(var i in a)a[i].forEach(function(s){e.push(s)});e=t.handleRepeat(e,"userid"),t.$parent.globalData.allUsers=e}();case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"formatDateData",value:function(e,s){if(!year||!day&&0!==day){var t=_utils2.default.formatDateTime(new Date);t=t.split(/[-:\s]/),year=parseInt(t[0]),month||(month=t[1]),day=parseInt(t[2])-1}switch(1===e&&30===day&&(s+1===7||s-1==7||s+1===8||s-1==8)&&("07"===month||"08"===month&&8!==s)||(day=30===day?day-1:day),e){case 0:year=s+1971;break;case 1:month=_utils2.default.addZeroToTime(s+1);break;case 2:day=s}}},{key:"onLoad",value:function(){var e=this.$parent.globalData.windowWH||{},s=this.$parent.globalData.allUsers,t=e.height;t=t||667,this.height=t-100,this.getIssueClassList(),(!s||Array.isArray(s)&&0===s.length)&&this.getAllUser()}},{key:"onShow",value:function(){var e=this,s=(0,_loginInfo.getUserInfo)();this.$parent.globalData.userInfo=s,this.userInfo=s;var t=this.$parent.globalData.issueInfo||{},a=this.$parent.globalData.ccInfo,i=this.$parent.globalData.modifiedInfo||{};if(fileFlag)return fileFlag=!1;if(this.issueSubClass){if(t&&t.issueClass&&(this.issueClass=t.issueClass,this.issueClassName=t.issueClassName,this.issueSubClassName=t.issueSubClassName,this.issueSubClass!==t.issueSubClass&&(this.issueClassName="",this.issueSubClassName="",this.issueClassIndex=this.issueClassList.findIndex(function(s){return s.issue_class===e.issueClass}),this.issueSubClass=t.issueSubClass,this.issueClassName=t.issueClassName,this.issueSubClassName=t.issueSubClassName,this.getIssueSubClassList(t.issueClass),this.getIssueSubClassInfo(t.issueSubClass))),a.length>0){this.ccList=this.ccList.concat(a);var r=this.ccList.filter(function(e){return e.user_id});r=this.handleRepeat(r,"user_id");var n=this.ccList.filter(function(e){return e.group_id});n=this.handleRepeat(n,"group_id"),this.ccList=r.concat(n)}if(i&&i.modifiedCharger){var u=i.index,l=i.modifiedCharger;this.issueGraphList[u].charger=l.userid,this.issueGraphList[u].chargerName=l.nickname}}else t&&(this.issueClassName="",this.getIssueClassList(),this.issueClass=t.issueClass,this.issueSubClass=t.issueSubClass,this.issueClassName=t.issueClassName,this.issueSubClassName=t.issueSubClassName,this.getIssueSubClassList(this.issueClass),this.issueSubClass&&this.getIssueSubClassInfo(this.issueSubClass))}},{key:"onHide",value:function(){this.isToCC||(this.$parent.globalData.ccInfo=[]),this.isToCharger||(this.$parent.globalData.modifiedInfo={})}}]),s}(_wepy2.default.page);Page(require("./../../npm/wepy/lib/wepy.js").default.$createPage(taskCreate,"task/pages/taskCreate"));