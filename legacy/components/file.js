"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function i(n,a){try{var o=t[n](a),l=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(l).then(function(e){i("next",e)},function(e){i("throw",e)});e(l)}return i("next")})}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_http=require("./../utils/http.js"),wxApis=require("./../utils/wxApi.js"),moduleInfo=function(e){function t(){var e,r,i,n;_classCallCheck(this,t);for(var a=arguments.length,o=Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=i=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.config={navigationBarTitleText:"",navigationStyle:"custom"},i.props={item:{type:Object,default:{},twoWay:!0},index:{type:Number,default:0}},i.data={},i.methods={uploadFile:function(e,t){var r=this,i=r.item.columnsType?1:9;r.$emit("getFlag",!0),wx.chooseImage({count:i,success:function(e){r.addImages(e.tempFilePaths,e.tempFiles,function(e){if(e.length>0){if(r.item.columnsType)r.item.fileInfo=e[0],r.item.content=e[0].file_name,r.item.value=e[0].file_name,r.item.attachfileArr=e;else{var t=r.item.attachfileArr;r.item.attachfileArr=[].concat(_toConsumableArray(t),_toConsumableArray(e))}e.forEach(function(e){r.item.columnsType?(r.item.fileNameArr=[e.file_name],r.item.imgUrlArr=[e.file_name]):(r.item.fileNameArr.push(e.file_name),r.item.imgUrlArr.push(e.file_name));var t=e.file_name.split(".")[e.file_name.split(".").length-1].toLowerCase();t="jpg"===t||"jpeg"===t||"png"===t,r.item.columnsType?r.item.multi_attach_buff=[{downloadUrl:e.file_name,file_name:e.file_name,isImg:t,source_id:e.source_id}]:r.item.multi_attach_buff.push({downloadUrl:e.file_name,file_name:e.file_name,isImg:t,source_id:e.source_id}),r.$apply()})}})},fail:function(e){e.errMsg&&"chooseImage:fail cancel"!==e.errMsg&&r.failFileUpload()}})},deleteFile:function(e,t){this.item.fileNameArr.splice(t,1),this.item.imgUrlArr.splice(t,1),this.item.attachfileArr.splice(t,1),this.item.multi_attach_buff.splice(t,1),this.item.fileInfo&&(this.item.fileInfo="",this.item.content="",this.item.value=""),this.item.value=JSON.stringify(this.item.attachfileArr)}},n=r,_possibleConstructorReturn(i,n)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(){}},{key:"onShow",value:function(){}},{key:"addImages",value:function(){function e(e,r,i){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,i){var n,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],e.prev=1,a=0;case 3:if(!(a<t.length)){e.next=12;break}return e.next=6,(0,_http.uploadFile)({filePath:t[a],formData:{file:r}});case 6:o=e.sent,o=JSON.parse(o),o.sourceid&&n.push({file_name:t[a],source_id:o.sourceid});case 9:a++,e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),wxApis.logMethod("log","uploadFile = "+JSON.stringify(e.t0),_wepy2.default.$instance.globalData.logInfo);case 17:i&&i(n);case 18:case"end":return e.stop()}},e,this,[[1,14]])}));return e}()}]),t}(_wepy2.default.component);exports.default=moduleInfo;